<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Redirecionando…</title>
    <script>
      (async () => {
        const ig = new URLSearchParams(window.location.search).get('ig');
        const telefone = '5531984092207';
        const mensagem = `Oi, como funciona o acompanhamento?`;

        // Envia o @ para o n8n via webhook antes do redirecionamento
        if (ig) {
          try {
            await fetch("https://primary-production-e6b66.up.railway.app/webhook/scouting-lead", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ ig })
            });
          } catch (error) {
            console.error("Erro ao enviar para o webhook:", error);
          }
        }

        // Redireciona para o WhatsApp após o fetch
        const link = `https://wa.me/${telefone}?text=${encodeURIComponent(mensagem)}`;
        window.location.href = link;
      })();
    </script>
  </head>
  <body>
    <p>Redirecionando para o WhatsApp…</p>
  </body>
</html>
